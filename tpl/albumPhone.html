<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>会员中心</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/index.css" rel="stylesheet" />
		<link href="../css/phone.css" rel="stylesheet" />
		<link href="../css/buiding.css" rel="stylesheet" />
		<script src="../js/jquery-1.10.2.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/mui.min.js"></script>
		<style type="text/css">
			.uploadbtn{
				width: 200px;
				margin: 0 auto;
				/*border:1px red solid;*/
				margin-top: 10px;
			}
			.uploadbtn button{
				text-align: center;
				margin: 0 auto;
			}
			.showImg{
				text-align: center;
			}
			.showImg p img{
				width: 100%;
				border: 1px #0000FF solid;
			}
		</style>
	</head>
	<body>
<header class="mui-bar mui-bar-nav header">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">我的相册</h1>
</header>

<div class="mui-content">
	<div class="uploadbtn">
		<button type="button" class="mui-btn mui-btn-blue"> + 添加照片</button>	
		<button type="button" class="mui-btn mui-btn-blue"> + 添加视频</button>	
	</div>
			<div class="mui-content-padded showImg">
			<!--	<p>这是图片放大预览示例，点击如下图片体验全屏预览功能</p>-->
				<p>
					<img src="../img/banner1.png" data-preview-src="" data-preview-group="1" />
				</p>
				<!--<p>这是雷峰塔下的照片</p>-->
				<p>
					<img src="../img/banner2.png" data-preview-src="" data-preview-group="1" />
				</p>
				<!--<p>2015年武隆仙境拍摄： </p>-->
				<p>
					<img src="../img/banner3.png" data-preview-src="" data-preview-group="1" />
				</p>
			</div>
		</div>




	


	
	<script type="text/javascript">
			mui.init()
			var urlBase = 'http://api.yunji128.com/homage';
			var imgBase = 'http://img.yunji128.com/';
			function GetQueryString(name) {
			     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
			     var r = window.location.search.substr(1).match(reg);
			     if(r!=null)return  decodeURI(r[2]); return null;
			}
			var memorialId = GetQueryString("memorialId");
			
	
		$.ajax({
			      headers: {
			    	tokenInfo:window.localStorage.getItem("tokenInfo")
				  },  
			      type: "GET",
			      //contentType: "application/json",
			      dataType: "json",
			      
				  url: urlBase + "/api/album/albumFileList?dataId="+memorialId+"&type=album",
			      success:function(data){
					if(data.code=='SUCCESS'){
						//arlt(data);
							var list = data.result;
							//alert(data.result[0]);
							var contens = "";
							
							$.each(list,function(index,item){
								if(this.fileFormat='img'){
									contens += '<p><img src="'+imgBase+this.path+'_crop_280x150_60'+'" data-preview-src="" width="320" height="240"  data-preview-group="1" /></p>'
								}
								if(this.fileFormat='video'){
									contens += '<p id="videoH"><video  src="'+imgBase+this.path+'_crop_280x150_60+'" width="320" height="240" controls="controls" /></video></p>'
								}
					
							})
						   	
							document.getElementById("showImg").innerHTML = contens;
						}
			},	   
		 		error: function (message) {  
	                alert("提交数据失败！");  
	            }  
	       });
	
		$("#myimgID").click(function(){
				$("#upload").click();     
			});
		    function uploadImg(){  
		        var fd = new FormData(document.getElementById("uploadImgForm"));
				fd.append("path", "h5/memorphone");
				fd.append("fileFormat", "img");
				fd.append("fileSize", "10001");
				$.ajax({
					type : "POST",
					url : urlBase + "/file/fileUpload",
					data : fd,//FormId
					processData: false,  // 告诉jQuery不要去处理发送的数据
					contentType: false,   // 告诉jQuery不要去设置Content-Type请求头
					error : function(request) {
						//layer.alert('添加出现异常', {icon: 5});
					},
					success : function(data) {
						if (data.code == 'SUCCESS') {
							//$("#myimgID").attr("src",imgBase+data.result.path);
							editImg(data.result.path);
						} else {
							alert(data.message);
						}
					}
				}); 
			}
				
	var requestBody ={
      "fileFormat": fileFormat,
      "fileSize": fileSize,
      "path": path
    }
				
				function editImg(path){
					$.ajax({  
						type: "POST",  
						headers: {
							tokenInfo: window.localStorage.getItem("tokenInfo")
						},
						url: urlBase + "/api/album/uploadFileToAlbum",  
					   contentType: "application/json; charset=utf-8",  
						data: JSON.stringify(requestBody),  
						dataType: "json",  
						success: function (data) {
							if(data.code=='SUCCESS'){
								alert("修改头像成功!");
								//window.location.reload();
								window.location.href="headInfo.html";
								
							}
							else{
								alert(data.message)
							}
						},  
						error: function (message) {  
							alert("提交数据失败！");  
						}  
				   });
		    }	
	</script>
	</body>
</html>