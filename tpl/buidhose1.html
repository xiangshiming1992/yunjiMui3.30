<!doctype html><html><head>    <meta charset="UTF-8">    <title>创建纪念馆</title>    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>    <link href="../css/mui.min.css" rel="stylesheet"/>    <link href="../css/index.css?version=3.2" rel="stylesheet"/>    <link href="../css/buiding.css?version=3.2" rel="stylesheet"/>    <script src="../js/jquery-1.10.2.js"></script>    <script src="../js/weixinShare.js" type="text/javascript" charset="utf-8"></script></head><style type="text/css">    .mui-table-view-cell {        border: 1px solid white;    }    #imgChangjing {        vertical-align: middle;        width: 80%;    }    .checkedImg {        border: 2px solid #007AFF;    }    .deathPhoto{    	width: 44%;    	/*border: 1px red solid;*/    }</style><body><form id="create"></form><div class="mui-content">    <h5 class="mui-content-padded">纪念馆地址</h5>    <div class="mui-input-row mui-password" id="showMap">        <input type="text" readonly form="create" name="address" placeholder="点击选择地址"></span>        <input type="hidden" readonly form="create" name="addressName"></span>        <!--经度-->        <input type="hidden" name="longitude" form="create">        <!--维度-->        <input type="hidden" name="latitude" form="create">    </div>    <h5 class="mui-content-padded">请选择纪念类型</h5>    <div class="mui-card">        <form class="mui-input-group">            <div class="mui-input-row mui-radio mui-left">                <label>个人馆</label>                <input name="memorialType" type="radio" value="personal" checked form="create">            </div>            <div class="mui-input-row mui-radio mui-left">                <label>名人馆</label>                <input name="memorialType" type="radio" value="celebrity" form="create">            </div>        </form>    </div>    <h5 class="mui-content-padded">请设置纪念馆名称：</h5>    <div class="mui-input-row">        <input type="text" id="memorialName" name="memorialName" placeholder="2-5个字，限中文" form="create">    </div>    <h5 class="mui-content-padded">请修改馆主类型</h5>    <div class="mui-card">        <form class="mui-input-group">            <div class="mui-input-row mui-radio mui-left">                <label>活人</label>                <input name="survivalMode" type="radio" value="A" checked>            </div>            <div class="mui-input-row mui-radio mui-left">                <label>逝者</label>                <input name="survivalMode" type="radio" value="B">            </div>        </form>    </div>    <div class="">        <div class="mui-segmented-control">            <a class="mui-control-item mui-active" href="#item1">选择平台模板</a>            <a class="mui-control-item" href="#item2">自定义上传模板</a>        </div>        <div class="">            <div id="item1" class="mui-control-content mui-active">                <ul class="mui-table-view" id="mpersonal">                    <div class="">                        <div class="mui-slider-group mui-slider-loop">                            <div class="mui-slider-item">                                <ul class="mui-table-view mui-grid-view" id="modelChose">                                </ul>                            </div>                        </div>                    </div>                </ul>            </div>            <div id="item2" class="mui-control-content">                <ul class="mui-table-view" id="mcustom">                    <div class="deathPhoto">                        <h5 class="mudiImg mui-content-padded">墓地照片</h5>                        <img class="userImg" id="myimgID" width="128px" height="164px" src="../img/deathimg.png"/>                        <form id="uploadImgForm">                            <input id="upload" name="fileName" onchange="uploadImg()" accept="image/*" type="file" style="display: none"/>                        </form>                        <h5 class="bili mui-content-padded">最佳比例 720*1280</h5>
                        <h5 class="bili mui-content-padded">(需20000银子)</h5>                    </div>                </ul>            </div>        </div>    </div>    <div style="height: 0.5rem"></div>    <div id="quanxian">        <h5 class="mui-content-padded">进入权限：</h5>        <div id="chousejoinType" class="mui-switch mui-switch-blue mui-switch-mini mui-active">            <div class="mui-switch-handle"></div>        </div>    </div>    <input type="hidden" id="joinType" name="joinType" value="password" placeholder="" form="create">    <div class="mui-input-row">        <input type="password" id="password" name="password" placeholder="6个数字" form="create">    </div>    <input type="hidden" id="memorialModelId" name="memorialModelId" form="create">    <button type="button" id="nextB" class="mui-btn mui-btn-primary mui-btn-block nextbtn">下一步</button>    <input id="customizeHeadImg" name="customizeHeadImg" type="hidden" value="" form="create"/>    <input id="modelSource" name="modelSource" type="hidden" value="A" form="create"/></div><div id="chooseAddress">    <iframe id="mapPage" width="100%" frameborder=0 ></iframe>    <nav class="mui-bar" style="padding-left: 0;padding-right: 0"><button class="mui-btn-blue" id="sure" style="width: 100%;">确定</button></nav></div><script charset="utf-8" src="http://map.qq.com/api/js?v=2.exp&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77"></script><script src="../js/mui.min.js"></script><script type="text/javascript">    mui.init()    //模版列表    var imgBase = "http://img.yunji128.com/";    var urlBase = 'http://api.yunji128.com/homage';    var isManual = true; //标志按钮最后状态    $(function () {        //对按钮进行监听        document.getElementById("chousejoinType").addEventListener('tap', function (event) {            isManual = !isManual;            if (isManual) {                $("#joinType").val("password");                $('#password').css("visibility","visible");            } else {                $("#joinType").val("direct");                $('#password').css("visibility","hidden");            }        });    });    $.ajax({        headers: {            tokenInfo: window.localStorage.getItem("tokenInfo")        },        type: "GET",        contentType: "application/json",        dataType: "json",        url: urlBase + "/api/memorial/modelList?deviceType=H5", //这里是网址        success: function (data) {            var list = data.result;            var contens = "";            $.each(list, function () {                contens += '<li class="mui-table-view-cell mui-media mui-col-xs-4" id="abc_' + this.memorialModelId + '">'                    +                    '<a href="javascript:chouseModel(' + this.memorialModelId + ');" ><img id="imgChangjing" class="mui-media-object" src="' + imgBase + this.thumImg + '"><div class="mui-media-body">' + this.modelName + '</div><div class="mui-media-body">(需' + this.useCloudBi + '银子)</div></a></li>'            });            document.getElementById('modelChose').innerHTML = contens;        },        error: function (message) {            mui.alert("读取姓氏列表失败");        }    });    function chouseModel(memorialModelId) {        $(".mui-table-view-cell").removeClass("checkedImg")        $("#abc_" + memorialModelId).addClass("checkedImg")        $("#memorialModelId").val(memorialModelId);        $("modelSource").val('A');        $("#customizeHeadImg").val('');    }    $("#myimgID").click(function () {        $("#upload").click();    });    function uploadImg() {        var fd = new FormData(document.getElementById("uploadImgForm"));        fd.append("path", "h5/customizeHead");        fd.append("fileFormat", "img");        fd.append("fileSize", "10001");        $.ajax({            type: "POST",            url: urlBase + "/file/fileUpload",            data: fd,//FormId            processData: false,  // 告诉jQuery不要去处理发送的数据            contentType: false,   // 告诉jQuery不要去设置Content-Type请求头            error: function (request) {                //layer.mui.alert('添加出现异常', {icon: 5});            },            success: function (data) {                if (data.code == 'SUCCESS') {                    $("#myimgID").attr("src", imgBase + data.result.path);                    $("#customizeHeadImg").val(data.result.path);                    $("#modelSource").val('B');                    $(".mui-table-view-cell").removeClass("checkedImg")                    $("#memorialModelId").val('');                } else {                    mui.alert(data.message);                }            }        });    }    $("#nextB").click(function () {        var memorialType = $('input[name="memorialType"]:checked ').val();        var survivalMode = $('input[name="survivalMode"]:checked ').val();        var memorialName = $("#memorialName").val();        var joinType = $("#joinType").val();        var modelSource = $("#modelSource").val();        var customizeHeadImg = $("#customizeHeadImg").val();        var memorialModelId = $("#memorialModelId").val();        var password = $('#password').val();        if (memorialName == '') {            mui.alert("请输入纪念馆名字");            return;        }        if (modelSource == "A") {            if (memorialModelId == '') {                mui.alert("请选择一个模版");                return;            }        }        if (modelSource == "B") {            if (customizeHeadImg == '') {                mui.alert("请上传自定义图片");                return;            }        }        window.location.href ="buidhose2.html?"+$("#create").serialize();        //     "buidhose2.html?memorialType=" + memorialType + "&survivalMode=" + survivalMode +        //     "&memorialName=" + memorialName + "&memorialModelId=" + memorialModelId + "&joinType=" + joinType + "&password=" + password        //     + "&modelSource=" + modelSource + "&customizeHeadImg=" + customizeHeadImg;    });    var address;    window.addEventListener('message', function(event) {        // 接收位置信息，用户选择确认位置点后选点组件会触发该事件，回传用户的位置信息        var loc = event.data;        if (loc && loc.module == 'locationPicker') {//防止其他应用也会向该页面post信息，需判断module是否为'locationPicker'            console.log('location', loc);            address = loc        }    }, false);    var chooseAddress = $("#chooseAddress").html();    $("#showMap").click(function () {        $(".mui-content").hide();        $("#chooseAddress").show();        var iframeSrc ="http://apis.map.qq.com/tools/locpicker?search=1&type=1&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77&referer=myapp";        var beforeAddr = "coord=40.022964,116.319723";        if (address) {            iframeSrc+="&coord="+address.latlng.lat+","+address.latlng.lng;        }        $("#mapPage").css("height",$(window).height() - $("nav").height());        $("#mapPage").attr("src",iframeSrc);        $("#sure").click(function () {            if (address) {                var latlng= address.latlng;                $("input[name=latitude]").val(latlng.lat);                $("input[name=longitude]").val(latlng.lng);                if (address.poiaddress) {                    $("input[name=address]").val(address.poiaddress);                    $("input[name=addressName]").val(address.poiname);                }else {                    geocoder.getAddress(new qq.maps.LatLng(latlng.lat, latlng.lng));                }                $("#chooseAddress").hide();                $("#chooseAddress").html(chooseAddress);                $(".mui-content").show();            }else {                mui.alert("你还米有选择一个地址")            }        });    });    var geocoder = new qq.maps.Geocoder();    //设置服务请求成功的回调函数    geocoder.setComplete(function (result) {        console.log(result);        $("input[name=address]").val(result.detail.address.replace("中国",""));        $("input[name=addressName]").val(result.detail.addressComponents.town);    });</script></body></html>