<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>会员中心</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<!--<link href="../css/index.css" rel="stylesheet" />
		<link href="../css/phone.css" rel="stylesheet" />
		<link href="../css/buiding.css" rel="stylesheet" />-->
		<script src="../js/jquery-1.10.2.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/mui.min.js"></script>
		<style type="text/css">
			
			.uploadbtn {
				width: 200px;
				margin-left: 2%;
				/*border:1px red solid;*/
				margin-top: 16px;
			}
			.photolist{
				float: left;
				background: #FFFFFF;
				width: 100%;
				
				margin-top: 10px;
				padding: 6px;
				}
			.photolist .coverImg{
				float: left;
				border: 1px #D4D4D4 solid;
				background:#FFFFFF ;
				width: 46%;
				height: 150px;
				text-align: center;
				margin: 6px;
				}
			.photolist .coverImg img{				
				width: 140px;
				height: 108px;
				margin-top: 6px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">相册管理</h1>
		</header>

		<div class="mui-content">
			<!--<div class="uploadbtn">
				<button type="button" id="myimgID" class="mui-btn mui-btn-blue"> 创建相册</button>
				<form id="uploadImgForm">
					<input id="imgupload" name="fileName" onchange="uploadImg(img)" type="file" accept="img/*" style="display: none;" />
				</form>
			</div>
			-->
			<div class="photolist">
				<div class="coverImg">
					<img src="../img/jia.png" />
					<h5>新建相册</h5>
				</div>
				<div class="coverImg">
					<img src="../img/my.png" />
					<h5>我的风景照片<span>(555)</span></abbr></h5>
				</div>
				<div class="coverImg">
					<img src="../img/1.jpg" />
					<h5>我的风景照片<span>(555)</span></abbr></h5>
				</div>
				<div class="coverImg">
					<img src="../img/2.jpg" />
					<h5>我的风景照片<span>(555)</span></abbr></h5>
				</div>
				<div class="coverImg">
					<img src="../img/1.jpg" />
					<h5>我的风景照片<span>(555)</span></abbr></h5>
				</div>
				<div class="coverImg">
					<img src="../img/2.jpg" />
					<h5>我的风景照片<span>(555)</span></abbr></h5>
				</div>
			</div>
			
		</div>

		<script type="text/javascript">
			mui.init()
			var urlBase = 'http://api.yunji128.com/homage';
			var imgBase = 'http://img.yunji128.com/';

			function GetQueryString(name) {
				var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
				var r = window.location.search.substr(1).match(reg);
				if(r != null) return decodeURI(r[2]);
				return null;
			}
			var memorialId = GetQueryString("memorialId");

			//请求图片信息列表
			$.ajax({    
				headers: {
					tokenInfo: window.localStorage.getItem("tokenInfo")
				},
				       type: "GET",
				       //contentType: "application/json",
				      dataType: "json",
				      
				url: urlBase + "/api/album/albumFileList?&type=album",
				      success: function(data) {
					if(data.code == 'SUCCESS') {
						//arlt(data);
						var list = data.result;
						//alert(data.result[0]);
						var contens = "";

						$.each(list, function(index, item) {
							if(this.fileFormat = 'img') {
								contens += '<p><img src="' + imgBase + this.path + '_crop_280x150_60' + '" data-preview-src="" width="320" height="240"  data-preview-group="1" /></p>'
							}
							if(this.fileFormat = 'video') {
								contens += '<p id="videoH"><video  src="' + imgBase + this.path + '_crop_280x150_60+'
								" width="
								320 " height="
								240 " controls="
								controls " /></video></p>'
							}
						})
						console.log(data);
						document.getElementById("showImg").innerHTML = contens;
					}
				},
				   
				error: function(message) {
					alert("提交数据失败！");
				}
			});

			$("#myimgID").click(function() {
				$("#imgupload").click();
			});
			$("#myvideoID").click(function() {
				$("#videoupload").click();
			});

			function uploadImg(fileFormat) {
				var fd = null;
				if(fileFormat == "img") {
					fd = new FormData(document.getElementById("uploadImgForm"));
					fd.append("path", "h5/memorphone");
					fd.append("fileFormat", "img");
				}
				if(fileFormat == "video") {
					fd = new FormData(document.getElementById("uploadImgForm"));
					fd.append("path", "h5/memorphone");
					fd.append("fileFormat", "video");
				}
				fd.append("fileSize", "10001");

				$.ajax({
					type: "POST",
					url: urlBase + "/file/fileUpload",
					data: fd, //FormId
					processData: false, // 告诉jQuery不要去处理发送的数据
					contentType: false, // 告诉jQuery不要去设置Content-Type请求头
					error: function(request) {
						//layer.alert('添加出现异常', {icon: 5});
					},
					success: function(data) {
						if(data.code == 'SUCCESS') {
							//$("#myimgID").attr("src",imgBase+data.result.path);
							editImg(data.result.path, fileFormat);
						} else {
							alert(data.message);
						}
					}
				});
			}

			function editImg(path, fileFormat) {

				var requestBody = {
					"dataId": albumId,
					"files": [{
						"fileFormat": fileFormat,
						"fileSize": 100,
						"path": "path"
					}],
					"type": "album"
				}
				$.ajax({
					type: "POST",
					headers: {
						tokenInfo: window.localStorage.getItem("tokenInfo")
					},
					url: urlBase + "/api/album/uploadFileToAlbum",
					contentType: "application/json; charset=utf-8",
					data: JSON.stringify(requestBody),
					dataType: "json",
					success: function(data) {
						if(data.code == 'SUCCESS') {
							alert("上传成功!");
							window.location.reload();
							//window.location.href="headInfo.html";

						} else {
							alert(data.message)
						}
					},
					error: function(message) {
						alert("提交数据失败！");
					}
				});
			}
		</script>
	</body>

</html>