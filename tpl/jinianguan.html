<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>纪念馆</title>
    <script src="../js/mui.min.js"></script>
    <link href="../css/mui.min.css" rel="stylesheet"/>
     <link href="../css/index.css" rel="stylesheet"/>
     <link href="../css/list.css" rel="stylesheet"/>     
    <script src="../js/jquery-1.10.2.js" type="text/javascript" charset="utf-8"></script>

</head>
<body>
<!-- <header class="mui-bar mui-bar-nav header">
     <h1 class="mui-title">纪念馆</h1>
 </header>-->
  
<!--  轮播图-->
  <div class="mui-slider bannertop">
    <div class="mui-slider-group mui-slider-loop mCreat">
      <!--第一个内容区容器-->      
      <div class="mui-slider-item">
      <!-- 具体内容 -->
              <img src="../img/banner1.png"/>
      </div>
      <!--第二个内容区-->
      <div class="mui-slider-item">
        <!-- 具体内容 -->
        	<img src="../img/banner2.png"/>
      </div>
    </div>
    <div id="creatBtn"><img src="../img/creat.png"/></div>
  </div>
  <script>
	document.getElementById('creatBtn').addEventListener('tap', function() {
		//打开纪念馆详情页面
		mui.openWindow({
		    url: 'buidhose1.html', 
		    id:'buidhose1'
		});
	});


// 	$("#creatBtn").click(function(){
// 		window.location.href="jinianguanDetail.html"})
 </script>
  <!--搜索-->
  <div class="mui-input-row mui-search">
      <input type="search" class="mui-input-clear " placeholder="馆号|馆名|被纪念人姓名">
  </div>
<!--  选项卡-->
 <div class="mui-slider">
     <div class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
         <a class="mui-control-item" href="#item1">私人馆</a>
         <a class="mui-control-item" href="#item2">公益馆</a>
         <a class="mui-control-item" href="#item3">最旺馆</a>
     </div>
       <div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-4"></div>
     <div class="mui-slider-group">
 <div id="item1" class="mui-slider-item mui-control-content mui-active">
   <ul class="mui-table-view" id="mpersonal">
              
<script type="application/javascript">
	var imgBase = "http://img.yunji128.com/";
	var urlBase = 'http://api.yunji128.com/homage';
 	$.ajax({
	      type: "GET",
	      contentType: "application/json",
	      dataType: "json",
		  url: urlBase + "/api/memorial/list?memorialType=personal&deviceType=H5&currentPage=1&limit=50",
	      success:function(data){
			var listPersonal = data.result.content;
			var memorialContent = "";
			$.each(listPersonal, function(){     
			    memorialContent +='<div><li class="mui-table-view-cell mui-media list1"><a href="javascript:info('+this.memorialId+');"><h4>'+this.memorialName+'</h4>'+
				'<img class="mui-media-object mui-pull-left" src="'+imgBase+this.headImg+'">'+
    			'<div class="mui-media-body"><ul class="smallul"><li>馆号：<span>'+this.userId+'</span></li><li>建馆人：<span>'+this.nickname +'</span></li></ul>'+ 
 			 	'<ul class="smallul"><li>祭拜数：<span>'+this.worshipCount +'</span></li><li>建馆时间：<span>'+this.rowAddTime +'</span></li></ul></div></a></li></div>'
 			 });
			document.getElementById('mpersonal').innerHTML = memorialContent;
		},
      error: function (message) {
      	alert("读取私人馆列表失败");
      }
    });
</script>     
   </ul>
</div>
  <div id="item2" class="mui-slider-item mui-control-content">
      <ul class="mui-table-view" id="mcelebrity">
	<script type="application/javascript">
 	$.ajax({
		      type: "GET",
		      contentType: "application/json",
		      dataType: "json",
		      url: urlBase+"/api/memorial/list?memorialType=celebrity&deviceType=H5&currentPage=1&limit=50", //这里是网址
		      success:function(data){
				var listcelebrity = data.result.content;
				var memorialcelebrity = "";
				$.each(listcelebrity, function(){     
				    memorialcelebrity +='<li class="mui-table-view-cell mui-media list1"><a href="javascript:info('+this.memorialId+');"><h4>'+this.memorialName+'</h4>'+
					'<img class="mui-media-object mui-pull-left" src="'+imgBase+this.headImg+'">'+
        			'<div class="mui-media-body"><ul class="smallul"><li>馆号：<span>'+this.userId+'</span></li><li>建馆人：<span>'+this.nickname +'</span></li></ul>'+ 
	 			 	'<ul class="smallul"><li>祭拜数：<span>'+this.worshipCount +'</span></li><li>建馆时间：<span>'+this.rowAddTime +'</span></li></ul></div></a></li>'
	 			 });
				document.getElementById('mcelebrity').innerHTML = memorialcelebrity;
		},
	    error: function (message) {
	      	alert("读取公益馆列表失败");
	    }
   	});
	</script> 
       </ul>
</div>
    <div id="item3" class="mui-slider-item mui-control-content nav1">
    <ul class="mui-table-view" id="renqi">
      	<script type="application/javascript">
 		 $.ajax({
		      type: "GET",
		      contentType: "application/json",
		      dataType: "json",
		      url: urlBase+"/api/memorial/list?lab=xinhuo&deviceType=H5&currentPage=1&limit=50", //这里是网址
		      success:function(data){
				var listrenqi = data.result.content;
				console.log(listrenqi)
				var memorialrenqi = "";
				$.each(listrenqi, function(){     
				    memorialrenqi +='<li class="mui-table-view-cell mui-media list1"><a href="javascript:info('+this.memorialId+');"><h4>'+this.memorialName+'</h4>'+
					'<img class="mui-media-object mui-pull-left" src="'+imgBase+this.headImg+'">'+
        			'<div class="mui-media-body"><ul class="smallul"><li>馆号：<span>'+this.userId+'</span></li><li>建馆人：<span>'+this.nickname +'</span></li></ul>'+ 
	 			 	'<ul class="smallul"><li>祭拜数：<span>'+this.worshipCount +'</span></li><li>建馆时间：<span>'+this.rowAddTime +'</span></li></ul></div></a></li>'
	 			 });
				document.getElementById('renqi').innerHTML = memorialrenqi;
			},
		    error: function (message) {
		      	alert("读取纪念馆列表失败");
		    }
   		});
	</script> 
	</ul>
	</div>
     </div>
 </div>
  <!--列表-->
<nav class="mui-bar mui-bar-tab">
      <a class="mui-tab-item mui-active" id="jinianguan">
          <span class="mui-icon mui-icon-home"></span>
          <span class="mui-tab-label">纪念馆</span>
      </a>
      <a class="mui-tab-item" id="jiapu">
          <span class="mui-icon mui-icon-map"></span>
          <span class="mui-tab-label">家谱圈</span>
      </a>
      <a class="mui-tab-item" id="xingshi">
          <span class="mui-icon mui-icon-navigate"></span>
          <span class="mui-tab-label">姓氏起源</span>
      </a>
      <a class="mui-tab-item" id="personal">
          <span class="mui-icon mui-icon-contact"></span>
          <span class="mui-tab-label">个人中心</span>
      </a>
  </nav>
<script src="../js/navJump.js"></script>
<script type="application/javascript">
	var urlBase = 'http://api.yunji128.com/homage';
	var imgBase = 'http://img.yunji128.com/';
	function info(id){
		$.ajax({  
			headers: {
		        tokenInfo: window.localStorage.getItem("tokenInfo")
		    },
	        type: "POST",  
	        url: urlBase + "/api/memorial/checkAccess?memorialId="+id,  
	        data: {},  
	        dataType: "json",  
	        success: function (data) {
	        	if(data.code=='SUCCESS'){
	        		if(data.result){
	        			window.location.href="jinianguanDetail.html?memorialId="+id;
	        		}else{
	        			if(inputPwd=prompt("请输入密码访问")){
	        				checkPwd(inputPwd,id);	
	        			}
	        		}
	        	}
	        	else{
	        		alert(data.message);
	        	}
	        },  
	        error: function (message) {  
	            alert("提交数据失败！");  
	        }  
	   });
	}
	function checkPwd(pwd,id){
		$.ajax({  
			headers: {
		    	tokenInfo:window.localStorage.getItem("tokenInfo"),
		    	userId:0
			},  
	        type: "GET",  
	        url: urlBase + "/api/memorial/accessMemorialcheckPassWorld?password="+pwd+"&memorialId="+id,  
	        data: {},  
	        dataType: "json",  
	        success: function (data) {
	        	if(data.code=='SUCCESS'){
	        		window.location.href="jinianguanDetail.html?memorialId="+id;
	        	}
	        	else{
	        		alert(data.message);
	        	}
	        },  
	        error: function (message) {  
	            alert("提交数据失败！");  
	        }  
	   });
	}
</script>
</body>
</html>