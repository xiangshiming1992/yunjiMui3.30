<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <link href="../css/mui.min.css?version=1.1" rel="stylesheet"/>
    <link href="../css/index.css?version=1.1" rel="stylesheet"/>
    <link href="../css/changjing.css?version=1.1" rel="stylesheet" />
    <script src="../js/jquery-1.10.2.js?version=1.1" type="text/javascript" charset="utf-8"></script>
    <style type="text/css">
    	#jibai{display: none;}
    	.showImg{
    		width: 90%;
    		background: #D4D4D4;
  			text-align: center;
			}
			.showImg p,.showVideo p{
				float: left;
				width: 46%;
				/*border: 2px red solid;*/
				
				margin: 2%;
			}
			.showImg p img{
				width: 100%;
				
				/*border: 1px #d1d1d1 solid;*/
				/*border-radius: 2px;*/
			}
			#videoH{
			/*	width:320px;*/
				height:150px;
			}
			
    </style>
<script src="../js/weixinShare.js" type="text/javascript" charset="utf-8"></script></head>
<body>
	 <header class="mui-bar mui-bar-nav header">
	 	<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
	     <h1 class="mui-title" id="mName">英灵永存 寄托哀思</h1>
	 </header>
	<div class="mui-content">  
  	<div class="muxiang">

  		
  		<!--<img id="mubeixiang"  src=""/>-->
  		<!--<span id="muzi" >张国荣之墓</span>-->
  	</div>
		<div class="changBuid">更换场景</div>
		
		<script type="application/javascript">
//单人室内
//		$(".muxiang").prepend('<img class="lingwei" id="lingwei" src="../img/lingpai1.png"/>');
//		$(".muxiang").append('<img class="mubeixiang_sn" id="mubeixiang" src="../img/mx.jpg"/>');
//		$(".muxiang").append('<span class="muzi_sn id="muzi">张国荣之灵位</span>')
//双人室内		
//	 	$(".muxiang").prepend('<img id="lingwei_L" src="../img/lingpai1.png"/>');
//	 	$(".muxiang").append('<img id="lingwei_R" src="../img/lingpai1.png"/>');
//		$(".muxiang").append('<img id="mubeixiang" class="mubeixiang_sn" src="../img/mx.jpg"/>');
//		$(".muxiang").append('<span class="muzi_sn_L id="muzi_sn_L">张固然之墓</span>')	
//		$(".muxiang").append('<span class="muzi_sn_R id="muzi_sn_R">张国荣之灵位</span>')
		
//单人室外
	
//		$(".muxiang").append('<img class="mubeixiang" id="mubeixiang" src="../img/mx.jpg"/>');
//		$(".muxiang").append('<span class="muzi id="muzi">张国荣之灵位</span>')
		
//双人室外		
//		$(".muxiang").append('<img class="mubeixiang" id="mubeixiang" src="../img/mx.jpg"/>');
//		$(".muxiang").append('<span class="muzi_sw_L id="muzi_sn_L">张固然之墓</span>')	
//		$(".muxiang").append('<span class="muzi_sw_R id="muzi_sn_R">张国荣之灵位</span>')
//		
		</script>

		
		
		<div id="jibai" class="mui-control-content mui-active">
			<!--<div class="close2"><img src="../img/shou.png"/></div>-->
				<div class="jingxian">我要敬献</div>
				<h6>收到礼物</h6>
					
				  <ul class="mui-table-view" id="jprec">
				      <!--<li class="mui-table-view-cell mui-media">
				          <a href="javascript:;">
				          	<img class="mui-media-object mui-pull-left" src="../img/xianhua.png">
				            <div class="mui-media-body"><h5>张三</h5><span class="mui-ellipsis">鲜花</span><span class="mui-ellipsis">敬献时间：2018-12-02</span></div>
				          </a>
				      </li>-->
				  </ul>

</div>		

 <!--<script>
 	
 	$(".close2").on("tap",function(){
   		$(this).parent().hide();
		}); 
	
 </script>	-->


<div id="shengping" class="mui-control-content ">
	
			<div class="zhaopian">
				<img id="personHeadimg" width="128px" height="164px" src=""/>								 			
				  
				  	<ul class="jianjie-info">
				  	<li><span>姓名：</span><span id="personName"></span></li>
				  	<li><span>性别：</span><span id="personSex"></span></li>
				  	<li><span>生辰：</span><span id="bornIn"></span></li>
				  	<li><span>忌日：</span><span id="diedIn"></span></li>
					</ul>
				 
				</div>
			<div class="jianjie">
				<h4>生平简介 </h4>
				<p id="introduction"></p>
			</div>	
</div>
<div id="xiangpian" class="mui-control-content">
	
	<div class="photo">
				<div class="photo-img"><span class="mui-icon mui-icon-image videoImg"></span><span>相片</span></div>			 			
			
			<div class="mui-content-padded showImg" id="showImg">
			<!--	<p>这是图片放大预览示例，点击如下图片体验全屏预览功能</p>-->
				<!--<p>
					<img src="../img/banner1.png" data-preview-src="" data-preview-group="1" />
				</p>
				<p>
					<img src="../img/banner2.png" data-preview-src="" data-preview-group="1" />
				</p>
				<p>
					<img src="../img/banner3.png" data-preview-src="" data-preview-group="1" />
				</p>-->
			</div>
		</div>		
</div>
<div id="video" class="mui-control-content">
	
	<div class="photo">
		<div class="photo-img"><span class="mui-icon mui-icon-videocam videoImg"></span><span>视频</span>	</div>			 			
		
	<div class="mui-content-padded showImg" id="showVideo">
			<!--	<p>这是图片放大预览示例，点击如下图片体验全屏预览功能</p>-->
				<!--<p>
					<img src="../img/banner1.png" data-preview-src="" data-preview-group="1" />
				</p>		
				<p>
					<img src="../img/banner2.png" data-preview-src="" data-preview-group="1" />
				</p>		
				<p>
					<img src="../img/banner3.png" data-preview-src="" data-preview-group="1" />
				</p>-->
			</div>
		</div>		
		</div>
	<div id="laifang" class="mui-control-content">
	<!--<div class="close2"><img src="../img/close.png"/></div>-->
				<h4>留言记录</h4>  
				  <ul class="mui-table-view" id="levRec">
				      <!--<li class="mui-table-view-cell mui-media">
				          <a href="javascript:;">
				              <img class="mui-media-object mui-pull-left" src="../img/touxiang.jpeg">
				              <div class="mui-media-body">
				                  	幸福
				                  <p class="mui-ellipsis">能和心爱的人一起睡觉，是件幸福的事情；可是，打呼噜怎么办？</p>
				              </div>
				          </a>
				      </li>-->
				  </ul>		
		<div class="liuyan">
				<!--<h4>留言</h4>-->
				<div class="mui-input-row inputliuyan" >
					<textarea id="levContent" rows="1" placeholder="留言"></textarea>
				</div>	
				<div class="fasong" id="sendLev">发送</div>
		</div>				
 		</div> 
	
 <!--下标签-->
<nav class="mui-bar mui-bar-tab">
      <a id="jb" class="mui-tab-item mui-active" href="#jibai">
          <span class="mui-icon mui-icon-home"></span>
          <span class="mui-tab-label">祭拜</span>
      </a>
      <a id="sp" class="mui-tab-item" href="#shengping">
          <span class="mui-icon mui-icon-map"></span>
          <span class="mui-tab-label">生平</span>
      </a>
      <a id="xp" class="mui-tab-item" href="#xiangpian">
          <span class="mui-icon mui-icon-image"></span>
          <span class="mui-tab-label">相片</span>
      </a>
      <a id="ph" class="mui-tab-item" href="#video">
          <span class="mui-icon mui-icon-videocam"></span>
          <span class="mui-tab-label">视频</span>
      </a>
      <a id="lf" class="mui-tab-item" href="#laifang">
          <span class="mui-icon mui-icon-contact"></span>
          <span class="mui-tab-label">留言</span>
      </a>
 </nav>
 
  <script> 	
 	$("#jb").on("tap",function(){
   		$("#jibai").slideToggle("slow");
   		$("#shengping").hide();
   		$("#xiangpian").hide();
   		$("#video").hide();
   		$("#laifang").hide();
		}); 
		
	$("#sp").on("tap",function(){
   		$("#shengping").toggle();
   		$("#jibai").hide();
   		$("#xiangpian").hide();
   		$("#video").hide();
   		$("#laifang").hide();
   		
		}); 
	$("#xp").on("tap",function(){
   		$("#xiangpian").slideToggle("slow");
   		$("#jibai").hide("slow");
   		$("#shengping").hide();
   		$("#video").hide();
   		$("#laifang").hide();
   		
   		
   		
   		
		}); 
	$("#ph").on("tap",function(){
   		$("#video").slideToggle("slow");
   		$("#jibai").hide("slow");
   		$("#shengping").hide();
   		$("#xiangpian").hide();
   		$("#laifang").hide();
		}); 
	$("#lf").on("tap",function(){
   		$("#laifang").slideToggle("slow");
   		$("#jibai").hide("slow");
   		$("#shengping").hide();
   		$("#video").hide();
   		$("#xiangpian").hide();
		}); 
	
 </script>	
 
 <script src="../js/mui.min.js?version=1.1"></script>
  <script type="application/javascript">
	mui.init({
			swipeBack:true //启用右滑关闭功能
	});
	var urlBase = 'http://api.yunji128.com/homage';
	var imgBase = 'http://img.yunji128.com/';
	function GetQueryString(name) {
	     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
	     var r = window.location.search.substr(1).match(reg);
	     if(r!=null)return  decodeURI(r[2]); return null;
	}
	var memorialId = GetQueryString("memorialId");
	var password = GetQueryString("password");
	var userId = 0;
	//主题信息 生平简介
	$.ajax({
	      headers: {
	    	tokenInfo:window.localStorage.getItem("tokenInfo"),
	    	userId:userId
		  },  
	      type: "GET",
	      contentType: "application/json",
	      dataType: "json",
	      url: urlBase + "/api/memorial/accessMemorial?deviceType=H5&password="+password+"&memorialId="+memorialId, //这里是网址
	      success:function(data){
		
			if(data.code=='SUCCESS'){
				document.title = data.result.memorialName+"的纪念馆";
				$("#personName").text(data.result.persons[0].personName);
				$("#personSex").text(data.result.persons[0].personSex);
				$("#bornIn").text(data.result.persons[0].bornIn);
				$("#diedIn").text(data.result.persons[0].diedIn);
				$("#introduction").text(data.result.persons[0].introduction);
				$("#personHeadimg").attr("src",imgBase+data.result.headImg);
//				$("#mubeixiang").attr("src",imgBase+data.result.headImg);
//				$("#muzi").text(data.result.persons[0].personName+"之墓");
				$(".mui-content").css("background","url("+imgBase+data.result.memorialModel.backImg+")no-repeat"); 
				$(".mui-content").css("background-size","100%100%"); 
				
			if(data.result.peopleNumber==1 ){
				if(data.result.memorialModel.scenesType  == "outdoor"){			
   			
				$(".muxiang").append('<img id="mubeixiang" src=""/>');
				$(".muxiang").append('<span id="muzi"></span>')
   				$("#mubeixiang").addClass("mubeixiang").removeClass("mubeixiang_sn");
   				$("#muzi").addClass("muzi").removeClass("muzi_sn");	
				$("#mubeixiang").attr("src",imgBase+data.result.headImg+"_crop_100x160_60");   				
   				$("#muzi").text(data.result.persons[0].personName+"之墓");
   				
   			  	}
				
				else if(data.result.memorialModel.scenesType == "indoor"){
   			   				
   					$(".muxiang").prepend('<img class="lingwei" id="lingwei" src="../img/lingpai1.png"/>');
					$(".muxiang").append('<img id="mubeixiang" src=""/>');
					$(".muxiang").append('<span id="muzi"></span>')	 				
   					$("#mubeixiang").addClass("mubeixiang_sn").removeClass("mubeixiang"); 				
   					$("#muzi").addClass("muzi_sn").removeClass("muzi");
					$("#mubeixiang").attr("src",imgBase+data.result.headImg);   					
   					$("#muzi").text(data.result.persons[0].personName+"之灵位");

   					
   					}
				else{
   					//alert("选择错误");
   				}
			}else if(data.result.peopleNumber==2){
				if(data.result.memorialModel.scenesType  == "outdoor"){					
	   				$(".muxiang").append('<img id="mubeixiang" src=""/>');
					$(".muxiang").append('<span id="muzi_sw_L"></span>')	
					$(".muxiang").append('<span id="muzi_sw_R"></span>')
				
	   				$("#mubeixiang").addClass("mubeixiang").removeClass("mubeixiang_sn");
	   				$("#muzi_sw_L").addClass("muzi_sw_L").removeClass("muzi_sn_L");
	   				$("#muzi_sw_R").addClass("muzi_sw_R").removeClass("muzi_sn_R");
	   				
					$("#mubeixiang").attr("src",imgBase+data.result.headImg+"_crop_100x160_60");   					
   					$("#muzi_sw_L").text(data.result.persons[1].personName+"之墓");
   					$("#muzi_sw_R").text(data.result.persons[0].personName+"之墓");
   				
   			  	  }

				else if(data.result.memorialModel.scenesType == "indoor"){
					$(".muxiang").prepend('<img id="lingwei_L" src="../img/lingpai1.png"/>');
				 	$(".muxiang").append('<img id="lingwei_R" src="../img/lingpai1.png"/>');
				 	
					$(".muxiang").append('<img id="mubeixiang" src=""/>');
					$(".muxiang").append('<span id="muzi_sn_L"></span>')	
					$(".muxiang").append('<span id="muzi_sn_R"></span>')
					
	   				$("#mubeixiang").addClass("mubeixiang_sn").removeClass("mubeixiang"); 				
	   				$("#muzi_sn_L").addClass("muzi_sn_L").removeClass("muzi_sw_L");
	   				$("#muzi_sn_R").addClass("muzi_sn_R").removeClass("muzi_sw_R");
	   				
					$("#mubeixiang").attr("src",imgBase+data.result.headImg+"_crop_100x160_60");   					
   					$("#muzi_sn_L").text(data.result.persons[1].personName+"之灵位");
   					$("#muzi_sn_R").text(data.result.persons[0].personName+"之灵位");	   				
	   				
	   				
   				  }
				else{
   					alert("选择错误");
   				}
			}else{
				alert("人数不对");
			}
			 
			}else if(data.code=='PleaseLogin'){
	    		window.location.href='login.html';
	    		
	    	}
		 }
    });

//判断单人和双人墓
//如果是单人墓
//	
// 如果是室内
//  创建一个img 给他一个src图片位置，付给1个排位的图片
//	创建一个id为mubeixiang 的img 给他一个src图片位置  ，动态赋予照片的位置
//	创建一个id为muzi的span   动态赋予墓志铭
//	将以上个创建的dom元素付给class为muxiang的div
//    分别将mubeixiang_sn和muzi_sn两个class属性给mubeixiang和muzi
// 
// 如果是室外
//  创建一个id为mubeixiang 的img 给他一个src图片位置  动态赋予照片的位置
//	创建一个id为muzi的span  动态赋予墓志铭
//	将这上个创建的dom元素给class为muxiang的div//  
//    将mubeixiang和muzi两个class属性分别给mubeixiang和muzi
//
//如果是双人墓
//	
// 如果是室内
//  创建一个img 给他一个src图片位置  付给2个排位的图片
//	创建一个id为mubeixiang 的img 给他一个src图片位置   动态赋予照片的位置
//	创建一个id为muzi_nan的span   动态赋予墓志铭
//	再创建一个id为muzi_nv的span   动态赋予墓志铭
//	将这上个创建的dom元素给class为muxiang的div
//    将mubeixiang_sn和muzi_sn两个class属性分别给mubeixiang和muzi
// 如果是室外
//  创建一个id为mubeixiang 的img 给他一个src图片位置  动态赋予照片的位置
//	创建一个id为muzi_nan的span 	动态赋予墓志铭
//	再创建一个id为muzi_nv的span   动态赋予墓志铭
//	将这上个创建的dom元素给class为muxiang的div
//    将mubeixiang和muzi两个class属性分别给mubeixiang和muzi
 
	//jibai记录
	$.ajax({
	      headers: {
	    	tokenInfo:window.localStorage.getItem("tokenInfo"),
	    	userId:userId
		  },  
	      type: "GET",
	      contentType: "application/json",
	      dataType: "json",
	      url: urlBase + "/api/sacrifice/memorialSaclist?memorialId="+memorialId+"&currentPage=1&limit=20", //这里是网址
	      success:function(data){
			if(data.code=='SUCCESS'){
				var list = data.result.content;
				var contens = "";
				$.each(list, function(){     
				    contens += '<li class="mui-table-view-cell mui-media"><a href="javascript:;"><img width="42px" height="42px" class="mui-media-object mui-pull-left" src="'+imgBase+this.sacrificeImg +'">'
				            +'<div class="mui-media-body">'+this.userName+'<p class="mui-ellipsis">'+this.dic+'</p></div></a></li>'
				}); 
				document.getElementById('jprec').innerHTML = contens;
			}
		 }
    });
	selectLev();
	//留言记录
	function selectLev(){
		$.ajax({
		      headers: {
		    	tokenInfo:window.localStorage.getItem("tokenInfo")
			  },  
		      type: "GET",
		      contentType: "application/json",
		      dataType: "json",
		      url: urlBase + "/api/leav/memorialLeavlist?dataId="+memorialId+"&leaType=memorial&currentPage=1&limit=20", //这里是网址
		      success:function(data){
				if(data.code=='SUCCESS'){
					var list = data.result.content;
					var contens = "";
					$.each(list, function(){     
					    contens += '<li class="mui-table-view-cell mui-media"><a href="javascript:;"><img width="42px" height="42px" class="mui-media-object mui-pull-left" src="'+imgBase+this.headImg +'">'
					            +'<div class="mui-media-body">'+this.userName+'<p class="mui-ellipsis">'+this.content+'</p></div></a></li>'
					}); 
					document.getElementById('levRec').innerHTML = contens;
				}
			 }
	    });
	}
	
	$("#sendLev").click(function(){
		var neirong = $("#levContent").val();
		if(neirong == ''){
			alert("请输入留言内容");return;
		}
	  	var conten = {
		  "dataId": memorialId,
		  "content": neirong
		};
	  	$.ajax({  
            type: "POST",  
            headers: {
		        tokenInfo: window.localStorage.getItem("tokenInfo")
		    },
            url: urlBase + "/api/leav/add?leaType=memorial",  
            data: conten,  
            dataType: "json",  
            success: function (data) {
            	if(data.code=='SUCCESS'){
            		alert("留言成功~~~");
            		$("#levContent").val('');
            		selectLev();
            	}
            	else{
            		alert(data.message)
            	}
            },  
            error: function (message) {  
                alert("提交数据失败！");  
            }  
       });
	});
	
	$(".jingxian").click(function(){
		window.location.href="jipin.html?memorialId="+memorialId;
	});
	$(".changBuid").on("tap",function(){
 		window.location.href="upgradehouse.html?memorialId="+memorialId;
	})
	
	//相册
	
	$("#xp").on("tap",function(){
		if($("#xiangpian").show()){
		
		$.ajax({
			      headers: {
			    	tokenInfo:window.localStorage.getItem("tokenInfo")
				  },  
			      type: "GET",
			      //contentType: "application/json",
			      dataType: "json",
			      
				  url: urlBase + "/api/album/albumFileList?dataId="+memorialId+"&type=memorial&fileFormat=img",
			      success:function(data){
					if(data.code=='SUCCESS'){
						//arlt(data);
							var list = data.result;							
							var contens = "";							
							$.each(list,function(index,item){
								/*if(this.fileFormat='img'){
									contens += '<p><img src="'+imgBase+this.path+'_crop_280x150_60'+'" data-preview-src="" width="320" height="240"  data-preview-group="1" /></p>'
								}
								if(this.fileFormat='video'){
									contens += '<p id="videoH"><video  src="'+imgBase+this.path+'" width="320" height="240" controls="controls" /></video></p>'
								}*/
								contens += '<p><img src="'+imgBase+this.path+'_crop_260x180_60'+'" data-preview-src="" data-preview-group="1" /></p>'
					
							})
						   	
							document.getElementById("showImg").innerHTML = contens;
						}
			},	   
		 		error: function (message) {  
	                alert("提交数据失败！");  
	            }  
	       });
	       	
		}
	 });
	 //视频
	 $("#ph").on("tap",function(){
	 	if($("#video").show()){
		$.ajax({
			      headers: {
			    	tokenInfo:window.localStorage.getItem("tokenInfo")
				  },  
			      type: "GET",
			      //contentType: "application/json",
			      dataType: "json",
			      
				  url: urlBase + "/api/album/albumFileList?dataId="+memorialId+"&type=memorial&fileFormat=video",
			      success:function(data){
					if(data.code=='SUCCESS'){
						//arlt(data);
							var list = data.result;
							//alert(data.result[0]);
							var contens = "";
							
							$.each(list,function(index,item){
								contens += '<p id="videoH"><video  src="'+imgBase+this.path+'" width="160" height="120" controls="controls" /></video></p>'
					
							})
//						   	  plyr.setup('video', { controls: ['play-large'] });//只显示大按钮
								
							document.getElementById("showVideo").innerHTML = contens;
						}
			},	   
		 		error: function (message) {  
	                alert("提交数据失败！");  
	            }  
	       });
	      }
	 });
  </script> 
</body>
</html>