<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>纪念馆</title>
    <script src="../js/mui.min.js"></script>
    <link href="../css/mui.min.css" rel="stylesheet"/>
     <link href="../css/index.css" rel="stylesheet"/>
     <link href="../css/list.css" rel="stylesheet"/>     
    <script src="../js/jquery-1.10.2.js" type="text/javascript" charset="utf-8"></script>
	<script type="application/javascript">
		var imgBase = "http://img.yunji128.com/";
		var urlBase = 'http://api.yunji128.com/homage';
		$.ajax({  
			headers: {
		        tokenInfo: window.localStorage.getItem("tokenInfo")
		    },
	        type: "GET",  
	        url: urlBase + "/api/user/userInfoByMe",  
	        data: {},  
	        dataType: "json",  
	        success: function (data) {
	        	if(data.code=='SUCCESS'){
	        		$("#nickname").html(data.result.nickname);
	        		$("#headImg").attr("src",imgBase + data.result.headImg);
	        	}
	        	else if(data.code=='PleaseLogin'){
	        		window.location.href='login.html';
	        	}
	        	else{
	        		alert(data.message);
	        	}
	        },  
	        error: function (message) {  
	            alert("提交数据失败！");  
	        }  
   		});
	</script>
</head>
<body>
 	<!--<header class="mui-bar mui-bar-nav header">
 	    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>   
		 <h1 class="mui-title">我的纪念馆</h1>
 	</header>-->
 
  <div class="mui-content">
  	
  <div class="mybanner"><img id="headImg" src=""/><h4 id="nickname"></h4></div>  
  
<!--  选项卡-->

  
 <div class="mui-slider">
     <div class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
         <a class="mui-control-item" href="#item1">私人馆</a>
         <a class="mui-control-item" href="#item2">双人馆</a>
         <a class="mui-control-item" href="#item3">名人馆</a>
     </div>
       <div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-4"></div>
     <div class="mui-slider-group">
         
         
 <div id="item1" class="mui-slider-item mui-control-content mui-active">
   <ul class="mui-table-view" id="mpersonal">
              
<script type="application/javascript">
			var imgBase = "http://img.yunji128.com/";
			var urlBase = 'http://api.yunji128.com/homage';
 			$.ajax({
		      type: "GET",
			  headers: {
	           	tokenInfo: window.localStorage.getItem("tokenInfo")
	    	  },
		      contentType: "application/json",
		      dataType: "json",
		      url: urlBase+"/api/memorial/mylist?deviceType=H5&currentPage=1&limit=50&peopleNumber=1", //这里是网址
		      success:function(data){
				var listPersonal = data.result.content;
				//alert(personallist)
				var memorialContent = "";
				$.each(listPersonal, function(){     
				    memorialContent +='<li class="mui-table-view-cell mui-media list1"><a href="javascript:info('+this.memorialId+');"><h4>'+this.memorialName+'</h4>'+
					'<img class="mui-media-object mui-pull-left" src="'+imgBase+this.headImg+'">'+
        			'<div class="mui-media-body"><ul class="smallul"><li>馆号：<span>'+this.userId+'</span></li><li>建馆人：<span>'+this.nickname +'</span></li></ul>'+ 
	 			 	'<ul class="smallul"><li>祭拜数：<span>'+this.worshipCount +'</span></li><li>建馆时间：<span>'+this.rowAddTime +'</span></li></ul></div></a></li>'
	 			 });
				document.getElementById('mpersonal').innerHTML = memorialContent;
			},
	      error: function (message) {
	      	alert("读取私人馆列表失败");
	      }
    });

</script>     
         
   </ul>
</div>
         
 
   
  <div id="item2" class="mui-slider-item mui-control-content">
      <ul class="mui-table-view" id="mcelebrity">
 
	<script type="application/javascript">
 		 $.ajax({
		      type: "GET",
		      contentType: "application/json",
		      dataType: "json",
			  headers: {
	           	tokenInfo: window.localStorage.getItem("tokenInfo")
	    	  },
		      url: urlBase+"/api/memorial/mylist?deviceType=H5&currentPage=1&limit=50&peopleNumber=2", //这里是网址
		      success:function(data){
				var listcelebrity = data.result.content;
				console.log(listcelebrity)
				var memorialcelebrity = "";
				$.each(listcelebrity, function(){     
				    memorialcelebrity +='<li class="mui-table-view-cell mui-media list1"><a href="javascript:info('+this.memorialId+');"><h4>'+this.memorialName+'</h4>'+
					'<img class="mui-media-object mui-pull-left" src="'+imgBase+this.headImg+'">'+
        			'<div class="mui-media-body"><ul class="smallul"><li>馆号：<span>'+this.userId+'</span></li><li>建馆人：<span>'+this.nickname +'</span></li></ul>'+ 
	 			 	'<ul class="smallul"><li>祭拜数：<span>'+this.worshipCount +'</span></li><li>建馆时间：<span>'+this.rowAddTime +'</span></li></ul></div></a></li>'
	 			 });
				document.getElementById('mcelebrity').innerHTML = memorialcelebrity;
			},
	      	error: function (message) {
	      	alert("读取公益馆列表失败");
	     		 }
   			});
	</script> 
       </ul>
</div>
         
         <div id="item3" class="mui-slider-item mui-control-content nav1">
             <ul class="mui-table-view" id="renqi">
      	<script type="application/javascript">
 		 $.ajax({
		      type: "GET",
		      contentType: "application/json",
		      dataType: "json",
			  headers: {
	           	tokenInfo: window.localStorage.getItem("tokenInfo")
	    	  },
		      url: urlBase+"/api/memorial/mylist?memorialType=celebrity&deviceType=H5&currentPage=1&limit=50", //这里是网址
		      success:function(data){
				var listrenqi = data.result.content;
				console.log(listrenqi)
				var memorialrenqi = "";
				$.each(listrenqi, function(){     
				    memorialrenqi +='<li class="mui-table-view-cell mui-media list1"><a href="javascript:info('+this.memorialId+');"><h4>'+this.memorialName+'</h4>'+
					'<img class="mui-media-object mui-pull-left" src="'+imgBase+this.headImg+'">'+
        			'<div class="mui-media-body"><ul class="smallul"><li>馆号：<span>'+this.userId+'</span></li><li>建馆人：<span>'+this.nickname +'</span></li></ul>'+ 
	 			 	'<ul class="smallul"><li>祭拜数：<span>'+this.worshipCount +'</span></li><li>建馆时间：<span>'+this.rowAddTime +'</span></li></ul></div></a></li>'
	 			 });
				document.getElementById('renqi').innerHTML = memorialrenqi;
			},
	      error: function (message) {
	      	alert("读取纪念馆列表失败");
	     	}
   		  });
	</script>         
                
             </ul>
         </div>
         
     </div>
 </div>
  
  <!--列表-->
  
<nav class="mui-bar mui-bar-tab">
      <a class="mui-tab-item mui-active" id="jinianguan">
          <span class="mui-icon mui-icon-home"></span>
          <span class="mui-tab-label">纪念馆</span>
      </a>
      <a class="mui-tab-item" id="jiapu">
          <span class="mui-icon mui-icon-map"></span>
          <span class="mui-tab-label">家谱圈</span>
      </a>
      <a class="mui-tab-item" id="xingshi">
          <span class="mui-icon mui-icon-navigate"></span>
          <span class="mui-tab-label">姓氏起源</span>
      </a>
      <a class="mui-tab-item" id="personal">
          <span class="mui-icon mui-icon-contact"></span>
          <span class="mui-tab-label">个人中心</span>
      </a>
  </nav>

 
<script src="../js/navJump.js"></script>
<script type="application/javascript">
	function info(id){
		var urlBase = 'http://api.yunji128.com/homage';
		var imgBase = 'http://img.yunji128.com/';
		$.ajax({  
			headers: {
		        tokenInfo: window.localStorage.getItem("tokenInfo")
		    },
	        type: "POST",  
	        url: urlBase + "/api/memorial/checkAccess?memorialId="+id,  
	        data: {},  
	        dataType: "json",  
	        success: function (data) {
	        	if(data.code=='SUCCESS'){
	        		if(data.result){
	        			window.location.href="jinianguanDetail.html?memorialId="+id;
	        		}else{
	        			//
	        			alert("请输入密码");
	        		}
	        	}
	        	else{
	        		alert(data.message);
	        	}
	        },  
	        error: function (message) {  
	            alert("提交数据失败！");  
	        }  
	   });
	}
</script>
</body>
</html>