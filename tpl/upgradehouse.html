<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>升级纪念馆</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/index.css" rel="stylesheet" />
		<link href="../css/buiding.css" rel="stylesheet" />
		 <script src="../js/jquery-1.10.2.js"></script>
	</head>
<style type="text/css">
	.mui-table-view-cell{
		border: 1px solid white;
	}
	.checkedImg{
		border: 1px solid gray;
	}
</style>
	<body>
<!--<header class="mui-bar mui-bar-nav header">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">创建纪念馆</h1>
</header>-->
<div class="mui-content">
		    <h5 class="mui-content-padded">修改纪念馆名称：</h5>
				<div class="mui-input-row">
					<input type="text" id="memorialName" placeholder="2-5个字，限中文">
				</div>	
			<h5 class="mui-content-padded">请选择纪念馆模板：</h5>
				<div class="mui-slider">
		        <div class="mui-slider-group mui-slider-loop">
		            <div class="mui-slider-item">
		                <ul class="mui-table-view mui-grid-view" id="modelChose">
		                </ul>
		            </div>
		        </div>
		 <div id="quanxian">
		  	
		 <h5 class="mui-content-padded">进入权限：</h5>
					<div id="chousejoinType" class="mui-switch mui-switch-blue mui-switch-mini switchdiv mui-active">
						<div class="mui-switch-handle"></div>
					</div>
		 </div> 		
		 		<input type="hidden" id="joinType" value="password" placeholder="">
				<div class="mui-input-row">
					<input type="password" id="password" placeholder="6个数字">
					
				</div>	
				<input type="hidden" id="memorialModelId">
			 <button type="button" id="saveB" class="mui-btn mui-btn-primary mui-btn-block nextbtn">下一步</button>
		
		
</div>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript">
			var isManual = true;//标志按钮最后状态
			mui.init()
			//模版列表
			var imgBase = "http://img.yunji128.com/";
			var urlBase = 'http://api.yunji128.com/homage';
			function GetQueryString(name) {
			     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
			     var r = window.location.search.substr(1).match(reg);
			     if(r!=null)return  decodeURI(r[2]); return null;
			}
	        var memorialId = GetQueryString("memorialId");
			$.ajax({
			      headers: {
		        		tokenInfo: window.localStorage.getItem("tokenInfo")
		    	  },  
			      type: "GET",
			      contentType: "application/json",
			      dataType: "json",
			      url: urlBase+"/api/memorial/basicInfo?memorialId="+memorialId,
			      success:function(data){
					if(data.code=='SUCCESS'){
						var memorialModelId = data.result.memorialModelId;
						$("#abc_"+memorialModelId).addClass("checkedImg")
						$("#memorialModelId").val(memorialModelId);
						$("#memorialName").val(data.result.memorialName);
						var joinType = data.result.joinType;
						if(joinType=='password'){
							$("#joinType").val("password");
			        	 	$('#password').show();
			        	 	$('#password').val('');
						}if(joinType=='direct'){
							$("#joinType").val("direct");
			        		$('#password').hide();
			        		$('#password').val('');
			        		$("#chousejoinType").removeClass("mui-active");
			        		isManual = false;
						}
	                }
	                else{
	                	alert(data.message)
	                }
				  },
			      error: function (message) {
			      	alert("读取姓氏列表失败");
			      }
		    });
		
			$(function() {
				//对按钮进行监听
			    document.getElementById("chousejoinType").addEventListener('toggle', function(event) {
			        isManual=!isManual;
			        if(isManual){
			        	$("#joinType").val("password");
			        	 $('#password').show();
			        }
			        else{
			        	$("#joinType").val("direct");
			        	$('#password').hide();
			        }
			    });
			});
			 $.ajax({
			      headers: {
		        		tokenInfo: window.localStorage.getItem("tokenInfo")
		    	  },  
			      type: "GET",
			      contentType: "application/json",
			      dataType: "json",
			      url: urlBase+"/api/memorial/modelList?deviceType=H5", //这里是网址
			      success:function(data){
					var list = data.result;
					var contens = "";
					$.each(list, function(){     
					    contens += '<li class="mui-table-view-cell mui-media mui-col-xs-4" id="abc_'+this.memorialModelId+'">'
		                    	+'<a href="javascript:chouseModel('+this.memorialModelId+');" ><img class="mui-media-object" src="'+imgBase+this.thumImg +'"><div class="mui-media-body">'+this.modelName+'</div></a></li>'
					}); 
					document.getElementById('modelChose').innerHTML = contens;
				},
		      	error: function (message) {
		      		alert("读取姓氏列表失败");
		      	}
		    });
			
			function chouseModel(memorialModelId){
				$(".mui-table-view-cell").removeClass("checkedImg")
				$("#abc_"+memorialModelId).addClass("checkedImg")
				$("#memorialModelId").val(memorialModelId);
			}
			
			$("#saveB").click(function(){
				var memorialType = $('input[name="memorialType"]:checked ').val();
				var memorialName = $("#memorialName").val();
				var memorialModelId = $("#memorialModelId").val();
				var joinType = $("#joinType").val();
			    var password = $('#password').val();
			    if(memorialName == ''){
					alert("请输入纪念馆名字");
					return;
				}
				if(memorialModelId == ''){
					alert("请选择一个模版");
					return;
				}
				var requestBody = {
				  "memorialId": memorialId,
				  "memorialName": memorialName,
				  "joinType": joinType,
				  "password": password,
				  "memorialModelId": memorialModelId
				};
			  	$.ajax({  
	                type: "POST",  
	                headers: {
				        tokenInfo: window.localStorage.getItem("tokenInfo")
				    },
	                url: urlBase + "/api/memorial/editBasic",  
	                contentType: "application/json; charset=utf-8",  
	                data: JSON.stringify(requestBody),  
	                dataType: "json",  
	                success: function (data) {
	                	if(data.code=='SUCCESS'){
	                		alert("修改成功~~~~~~~");
	                		window.location.href="myjinianguan.html"
	                	}
	                	else{
	                		alert(data.message)
	                	}
	                },  
	                error: function (message) {  
	                    alert("提交数据失败！");  
	                }  
	           });
			});
			
		</script>
	</body>
</html>